import React, { useState, useRef, useEffect } from 'react';
import { Play, RotateCcw, Check, X, Home } from 'lucide-react';

const BengaliLearningApp = () => {
  const [currentMode, setCurrentMode] = useState('home'); // home, letters, words
  const [selectedLetter, setSelectedLetter] = useState(null);
  const [selectedWord, setSelectedWord] = useState(null);
  const [isDrawing, setIsDrawing] = useState(false);
  const [currentPath, setCurrentPath] = useState('');
  const [paths, setPaths] = useState([]);
  const [feedback, setFeedback] = useState('');
  const canvasRef = useRef(null);

  // Bengali alphabet with pronunciations
  const bengaliAlphabet = [
    { bengali: 'অ', english: 'a', pronunciation: 'aw' },
    { bengali: 'আ', english: 'aa', pronunciation: 'ah' },
    { bengali: 'ই', english: 'i', pronunciation: 'ee' },
    { bengali: 'ঈ', english: 'ii', pronunciation: 'eee' },
    { bengali: 'উ', english: 'u', pronunciation: 'oo' },
    { bengali: 'ঊ', english: 'uu', pronunciation: 'ooo' },
    { bengali: 'এ', english: 'e', pronunciation: 'eh' },
    { bengali: 'ঐ', english: 'oi', pronunciation: 'oy' },
    { bengali: 'ও', english: 'o', pronunciation: 'oh' },
    { bengali: 'ঔ', english: 'ou', pronunciation: 'ow' },
    { bengali: 'ক', english: 'ka', pronunciation: 'kaw' },
    { bengali: 'খ', english: 'kha', pronunciation: 'khaw' },
    { bengali: 'গ', english: 'ga', pronunciation: 'gaw' },
    { bengali: 'ঘ', english: 'gha', pronunciation: 'ghaw' },
    { bengali: 'চ', english: 'cha', pronunciation: 'chaw' },
    { bengali: 'ছ', english: 'chha', pronunciation: 'chhaw' },
    { bengali: 'জ', english: 'ja', pronunciation: 'jaw' },
    { bengali: 'ঝ', english: 'jha', pronunciation: 'jhaw' },
    { bengali: 'ট', english: 'ta', pronunciation: 'taw' },
    { bengali: 'ঠ', english: 'tha', pronunciation: 'thaw' },
    { bengali: 'ড', english: 'da', pronunciation: 'daw' },
    { bengali: 'ঢ', english: 'dha', pronunciation: 'dhaw' },
    { bengali: 'ণ', english: 'na', pronunciation: 'naw' },
    { bengali: 'ত', english: 'ta', pronunciation: 'taw' },
    { bengali: 'থ', english: 'tha', pronunciation: 'thaw' },
    { bengali: 'দ', english: 'da', pronunciation: 'daw' },
    { bengali: 'ধ', english: 'dha', pronunciation: 'dhaw' },
    { bengali: 'ন', english: 'na', pronunciation: 'naw' },
    { bengali: 'প', english: 'pa', pronunciation: 'paw' },
    { bengali: 'ফ', english: 'pha', pronunciation: 'phaw' },
    { bengali: 'ব', english: 'ba', pronunciation: 'baw' },
    { bengali: 'ভ', english: 'bha', pronunciation: 'bhaw' },
    { bengali: 'ম', english: 'ma', pronunciation: 'maw' },
    { bengali: 'য', english: 'ya', pronunciation: 'yaw' },
    { bengali: 'র', english: 'ra', pronunciation: 'raw' },
    { bengali: 'ল', english: 'la', pronunciation: 'law' },
    { bengali: 'শ', english: 'sha', pronunciation: 'shaw' },
    { bengali: 'ষ', english: 'sha', pronunciation: 'shaw' },
    { bengali: 'স', english: 'sa', pronunciation: 'saw' },
    { bengali: 'হ', english: 'ha', pronunciation: 'haw' }
  ];

  // Simple Bengali words for children - authentic Bengali vocabulary
  const bengaliWords = [
    { bengali: 'মা', english: 'Mother', transliteration: 'maa' },
    { bengali: 'বাবা', english: 'Father', transliteration: 'baba' },
    { bengali: 'জল', english: 'Water', transliteration: 'jol' },
    { bengali: 'বই', english: 'Book', transliteration: 'boi' },
    { bengali: 'বাড়ি', english: 'House', transliteration: 'baari' },
    { bengali: 'গাড়ি', english: 'Car', transliteration: 'gaari' },
    { bengali: 'ফুল', english: 'Flower', transliteration: 'phul' },
    { bengali: 'চাঁদ', english: 'Moon', transliteration: 'chaand' },
    { bengali: 'সূর্য', english: 'Sun', transliteration: 'shurjo' },
    { bengali: 'মাছ', english: 'Fish', transliteration: 'maach' },
    { bengali: 'পাখি', english: 'Bird', transliteration: 'pakhi' },
    { bengali: 'হাত', english: 'Hand', transliteration: 'haat' },
    { bengali: 'চোখ', english: 'Eye', transliteration: 'chokh' },
    { bengali: 'নাম', english: 'Name', transliteration: 'naam' },
    { bengali: 'ভাত', english: 'Rice', transliteration: 'bhaat' },
    { bengali: 'দুধ', english: 'Milk', transliteration: 'dudh' },
    { bengali: 'মিষ্টি', english: 'Sweet', transliteration: 'mishti' },
    { bengali: 'আম', english: 'Mango', transliteration: 'aam' },
    { bengali: 'কলা', english: 'Banana', transliteration: 'kola' },
    { bengali: 'বিড়াল', english: 'Cat', transliteration: 'biraal' }
  ];

  // Text-to-speech function with better error handling
  const speakText = (text, lang = 'bn-BD') => {
    if ('speechSynthesis' in window) {
      // Cancel any ongoing speech
      speechSynthesis.cancel();
      
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = lang;
      utterance.rate = 0.7;
      utterance.pitch = 1;
      utterance.volume = 1;
      
      // Error handling
      utterance.onerror = (event) => {
        console.error('Speech synthesis error:', event);
        setFeedback('Audio not available - please check your device settings');
        setTimeout(() => setFeedback(''), 3000);
      };
      
      utterance.onstart = () => {
        setFeedback('🔊 Playing audio...');
        setTimeout(() => setFeedback(''), 2000);
      };
      
      // Try different language codes for Bengali
      const bengaliLangs = ['bn-BD', 'bn-IN', 'bn', 'hi-IN', 'en-US'];
      let langIndex = 0;
      
      const trySpeak = () => {
        if (langIndex < bengaliLangs.length) {
          utterance.lang = bengaliLangs[langIndex];
          speechSynthesis.speak(utterance);
          langIndex++;
        }
      };
      
      trySpeak();
    } else {
      setFeedback('Audio not supported on this device');
      setTimeout(() => setFeedback(''), 3000);
    }
  };

  // Drawing functions
  const startDrawing = (e) => {
    setIsDrawing(true);
    const canvas = canvasRef.current;
    const rect = canvas.getBoundingClientRect();
    const x = (e.clientX || e.touches[0].clientX) - rect.left;
    const y = (e.clientY || e.touches[0].clientY) - rect.top;
    setCurrentPath(`M ${x} ${y}`);
    setFeedback('');
  };

  const draw = (e) => {
    if (!isDrawing) return;
    e.preventDefault();
    const canvas = canvasRef.current;
    const rect = canvas.getBoundingClientRect();
    const x = (e.clientX || e.touches[0].clientX) - rect.left;
    const y = (e.clientY || e.touches[0].clientY) - rect.top;
    setCurrentPath(prev => `${prev} L ${x} ${y}`);
  };

  const stopDrawing = () => {
    if (isDrawing) {
      setIsDrawing(false);
      setPaths(prev => [...prev, currentPath]);
      setCurrentPath('');
      provideFeedback();
    }
  };

  const clearCanvas = () => {
    setPaths([]);
    setCurrentPath('');
    setFeedback('');
  };

  // Clear canvas when selecting a new letter or word
  useEffect(() => {
    clearCanvas();
  }, [selectedLetter, selectedWord]);

  const provideFeedback = () => {
    // Simple feedback based on stroke count
    const strokeCount = paths.length + 1;
    const feedbackMessages = [
      "Great start! Keep practicing!",
      "Nice work! You're getting better!",
      "Excellent tracing! Well done!",
      "Perfect! You're doing amazing!",
      "Wonderful! Keep up the good work!"
    ];
    const randomFeedback = feedbackMessages[Math.floor(Math.random() * feedbackMessages.length)];
    setFeedback(randomFeedback);
    
    setTimeout(() => setFeedback(''), 3000);
  };

  // Home Screen
  const HomeScreen = () => (
    <div className="min-h-screen bg-gradient-to-br from-blue-400 via-purple-400 to-pink-400 p-6">
      <div className="text-center mb-8">
        <h1 className="text-4xl font-bold text-white mb-4">Bengali Learning</h1>
        <p className="text-xl text-white/90">Learn Bengali letters and words!</p>
      </div>
      
      <div className="flex flex-col items-center space-y-6 max-w-md mx-auto">
        <button
          onClick={() => setCurrentMode('letters')}
          className="w-full bg-white/20 backdrop-blur-sm rounded-2xl p-6 text-white hover:bg-white/30 transition-all duration-300 border-2 border-white/30"
        >
          <div className="text-4xl mb-2">অ আ ই</div>
          <div className="text-xl font-semibold">Learn Letters</div>
          <div className="text-sm opacity-80">Practice Bengali alphabet</div>
        </button>
        
        <button
          onClick={() => setCurrentMode('words')}
          className="w-full bg-white/20 backdrop-blur-sm rounded-2xl p-6 text-white hover:bg-white/30 transition-all duration-300 border-2 border-white/30"
        >
          <div className="text-4xl mb-2">মা বাবা</div>
          <div className="text-xl font-semibold">Learn Words</div>
          <div className="text-sm opacity-80">Practice simple Bengali words</div>
        </button>
      </div>
    </div>
  );

  // Letters Screen
  const LettersScreen = () => (
    <div className="min-h-screen bg-gradient-to-br from-green-400 to-blue-500 p-4">
      <div className="flex items-center justify-between mb-6">
        <button
          onClick={() => setCurrentMode('home')}
          className="bg-white/20 rounded-full p-3 text-white hover:bg-white/30 transition-all"
        >
          <Home size={24} />
        </button>
        <h2 className="text-2xl font-bold text-white">Bengali Letters</h2>
        <div className="w-12"></div>
      </div>

      {!selectedLetter ? (
        <div className="grid grid-cols-5 gap-3 max-w-4xl mx-auto">
          {bengaliAlphabet.map((letter, index) => (
            <button
              key={index}
              onClick={() => setSelectedLetter(letter)}
              className="aspect-square bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center text-2xl font-bold text-white hover:bg-white/30 hover:scale-105 transition-all duration-300 border-2 border-white/30"
            >
              {letter.bengali}
            </button>
          ))}
        </div>
      ) : (
        <LetterPractice letter={selectedLetter} onBack={() => setSelectedLetter(null)} />
      )}
    </div>
  );

  // Words Screen
  const WordsScreen = () => (
    <div className="min-h-screen bg-gradient-to-br from-purple-400 to-pink-500 p-4">
      <div className="flex items-center justify-between mb-6">
        <button
          onClick={() => setCurrentMode('home')}
          className="bg-white/20 rounded-full p-3 text-white hover:bg-white/30 transition-all"
        >
          <Home size={24} />
        </button>
        <h2 className="text-2xl font-bold text-white">Bengali Words</h2>
        <div className="w-12"></div>
      </div>

      {!selectedWord ? (
        <div className="grid grid-cols-2 gap-4 max-w-4xl mx-auto">
          {bengaliWords.map((word, index) => (
            <button
              key={index}
              onClick={() => setSelectedWord(word)}
              className="bg-white/20 backdrop-blur-sm rounded-xl p-4 text-white hover:bg-white/30 hover:scale-105 transition-all duration-300 border-2 border-white/30"
            >
              <div className="text-3xl font-bold mb-2">{word.bengali}</div>
              <div className="text-lg">{word.english}</div>
              <div className="text-sm opacity-80">{word.transliteration}</div>
            </button>
          ))}
        </div>
      ) : (
        <WordPractice word={selectedWord} onBack={() => setSelectedWord(null)} />
      )}
    </div>
  );

  // Letter Practice Component
  const LetterPractice = ({ letter, onBack }) => (
    <div className="max-w-4xl mx-auto">
      <div className="bg-white/20 backdrop-blur-sm rounded-2xl p-6 mb-6">
        <div className="text-center mb-6">
          <div className="text-8xl font-bold text-white mb-4">{letter.bengali}</div>
          <div className="text-2xl text-white mb-2">Pronunciation: {letter.pronunciation}</div>
          <div className="flex justify-center space-x-4">
            <button
              onClick={() => speakText(letter.bengali)}
              className="bg-green-500 hover:bg-green-600 text-white rounded-full p-3 transition-all flex items-center space-x-2"
              title="Play pronunciation"
            >
              <Play size={24} />
              <span className="hidden sm:inline">Play Audio</span>
            </button>
            <button
              onClick={() => speakText(letter.pronunciation, 'en-US')}
              className="bg-blue-500 hover:bg-blue-600 text-white rounded-full p-3 transition-all flex items-center space-x-2"
              title="Play English pronunciation guide"
            >
              <Play size={20} />
              <span className="text-sm">English</span>
            </button>
          </div>
        </div>
      </div>

      <div className="bg-white/20 backdrop-blur-sm rounded-2xl p-6">
        <div className="text-center mb-4">
          <h3 className="text-xl font-bold text-white mb-2">Trace the letter</h3>
          <div className="flex justify-center space-x-4 mb-4">
            <button
              onClick={clearCanvas}
              className="bg-red-500 hover:bg-red-600 text-white rounded-xl px-4 py-2 font-semibold transition-all flex items-center space-x-2"
            >
              <RotateCcw size={20} />
              <span>Clear</span>
            </button>
          </div>
        </div>

        <div className="relative">
          <svg
            ref={canvasRef}
            width="100%"
            height="300"
            className="bg-white rounded-xl border-4 border-dashed border-white/50 cursor-crosshair touch-none"
            onMouseDown={startDrawing}
            onMouseMove={draw}
            onMouseUp={stopDrawing}
            onTouchStart={startDrawing}
            onTouchMove={draw}
            onTouchEnd={stopDrawing}
          >
            {/* Guide letter */}
            <text
              x="50%"
              y="50%"
              textAnchor="middle"
              dominantBaseline="central"
              className="text-8xl font-bold fill-gray-300"
              style={{ fontSize: '120px' }}
            >
              {letter.bengali}
            </text>
            
            {/* User's strokes */}
            {paths.map((path, index) => (
              <path
                key={index}
                d={path}
                stroke="#3B82F6"
                strokeWidth="4"
                strokeLinecap="round"
                strokeLinejoin="round"
                fill="none"
              />
            ))}
            {currentPath && (
              <path
                d={currentPath}
                stroke="#3B82F6"
                strokeWidth="4"
                strokeLinecap="round"
                strokeLinejoin="round"
                fill="none"
              />
            )}
          </svg>
          
          {feedback && (
            <div className="absolute top-4 left-1/2 transform -translate-x-1/2 bg-green-500 text-white px-4 py-2 rounded-full font-semibold animate-bounce">
              {feedback}
            </div>
          )}
        </div>

        <div className="text-center mt-4">
          <button
            onClick={onBack}
            className="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-full font-semibold transition-all"
          >
            Back to Letters
          </button>
        </div>
      </div>
    </div>
  );

  // Word Practice Component
  const WordPractice = ({ word, onBack }) => (
    <div className="max-w-4xl mx-auto">
      <div className="bg-white/20 backdrop-blur-sm rounded-2xl p-6 mb-6">
        <div className="text-center mb-6">
          <div className="text-6xl font-bold text-white mb-4">{word.bengali}</div>
          <div className="text-2xl text-white mb-2">{word.english}</div>
          <div className="text-xl text-white/80 mb-4">({word.transliteration})</div>
          <div className="flex justify-center space-x-4">
            <button
              onClick={() => speakText(word.bengali)}
              className="bg-green-500 hover:bg-green-600 text-white rounded-full p-3 transition-all flex items-center space-x-2"
              title="Play Bengali pronunciation"
            >
              <Play size={24} />
              <span className="hidden sm:inline">Bengali</span>
            </button>
            <button
              onClick={() => speakText(word.english, 'en-US')}
              className="bg-blue-500 hover:bg-blue-600 text-white rounded-full p-3 transition-all flex items-center space-x-2"
              title="Play English translation"
            >
              <Play size={20} />
              <span className="text-sm">English</span>
            </button>
            <button
              onClick={() => speakText(word.transliteration, 'en-US')}
              className="bg-purple-500 hover:bg-purple-600 text-white rounded-full p-3 transition-all flex items-center space-x-2"
              title="Play transliteration guide"
            >
              <Play size={18} />
              <span className="text-xs">Guide</span>
            </button>
          </div>
        </div>
      </div>

      <div className="bg-white/20 backdrop-blur-sm rounded-2xl p-6">
        <div className="text-center mb-4">
          <h3 className="text-xl font-bold text-white mb-2">Trace the word</h3>
          <div className="flex justify-center space-x-4 mb-4">
            <button
              onClick={clearCanvas}
              className="bg-red-500 hover:bg-red-600 text-white rounded-xl px-4 py-2 font-semibold transition-all flex items-center space-x-2"
            >
              <RotateCcw size={20} />
              <span>Clear</span>
            </button>
          </div>
        </div>

        <div className="relative">
          <svg
            ref={canvasRef}
            width="100%"
            height="300"
            className="bg-white rounded-xl border-4 border-dashed border-white/50 cursor-crosshair touch-none"
            onMouseDown={startDrawing}
            onMouseMove={draw}
            onMouseUp={stopDrawing}
            onTouchStart={startDrawing}
            onTouchMove={draw}
            onTouchEnd={stopDrawing}
          >
            {/* Guide word */}
            <text
              x="50%"
              y="50%"
              textAnchor="middle"
              dominantBaseline="central"
              className="text-6xl font-bold fill-gray-300"
              style={{ fontSize: '80px' }}
            >
              {word.bengali}
            </text>
            
            {/* User's strokes */}
            {paths.map((path, index) => (
              <path
                key={index}
                d={path}
                stroke="#8B5CF6"
                strokeWidth="4"
                strokeLinecap="round"
                strokeLinejoin="round"
                fill="none"
              />
            ))}
            {currentPath && (
              <path
                d={currentPath}
                stroke="#8B5CF6"
                strokeWidth="4"
                strokeLinecap="round"
                strokeLinejoin="round"
                fill="none"
              />
            )}
          </svg>
          
          {feedback && (
            <div className="absolute top-4 left-1/2 transform -translate-x-1/2 bg-green-500 text-white px-4 py-2 rounded-full font-semibold animate-bounce">
              {feedback}
            </div>
          )}
        </div>

        <div className="text-center mt-4">
          <button
            onClick={onBack}
            className="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-full font-semibold transition-all"
          >
            Back to Words
          </button>
        </div>
      </div>
    </div>
  );

  return (
    <div className="font-sans">
      {currentMode === 'home' && <HomeScreen />}
      {currentMode === 'letters' && <LettersScreen />}
      {currentMode === 'words' && <WordsScreen />}
    </div>
  );
};

export default BengaliLearningApp;
