<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bengali Word Recorder</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 600px;
            width: 100%;
            text-align: center;
        }

        .header {
            margin-bottom: 30px;
        }

        .header h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .word-display {
            background: #f8f9ff;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px solid #e1e8ff;
        }

        .bengali-word {
            font-size: 3.5em;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 15px;
            font-family: 'SolaimanLipi', 'Kalpurush', 'Mukti Narrow', serif;
        }

        .transliteration {
            font-size: 2em;
            color: #4a5568;
            margin-bottom: 10px;
            font-style: italic;
        }

        .english-meaning {
            font-size: 1.2em;
            color: #718096;
        }

        .progress {
            font-size: 1em;
            color: #9ca3af;
            margin-top: 15px;
        }

        .navigation {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .nav-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            background: #667eea;
            color: white;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .nav-btn:hover:not(:disabled) {
            background: #5a67d8;
            transform: translateY(-2px);
        }

        .nav-btn:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
        }

        .recording-controls {
            background: #fff5f5;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border: 2px solid #fed7d7;
        }

        .control-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 140px;
        }

        .record-btn {
            background: #f56565;
            color: white;
        }

        .record-btn:hover {
            background: #e53e3e;
            transform: scale(1.05);
        }

        .record-btn.recording {
            background: #e53e3e;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .play-btn {
            background: #48bb78;
            color: white;
        }

        .play-btn:hover:not(:disabled) {
            background: #38a169;
            transform: scale(1.05);
        }

        .play-btn:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
        }

        .status {
            font-size: 1.1em;
            font-weight: bold;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .status.ready { background: #c6f6d5; color: #22543d; }
        .status.recording { background: #fed7d7; color: #742a2a; }
        .status.saved { background: #bee3f8; color: #2a4365; }
        .status.playing { background: #e9d8fd; color: #44337a; }

        .download-section {
            background: #f0fff4;
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #c6f6d5;
        }

        .download-btn {
            background: #38a169;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .download-btn:hover {
            background: #2f855a;
            transform: translateY(-2px);
        }

        .download-btn:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
        }

        .completion-stats {
            margin-top: 15px;
            font-size: 1.1em;
            color: #2d3748;
        }

        .error {
            background: #fed7d7;
            color: #742a2a;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
                margin: 10px;
            }

            .bengali-word {
                font-size: 2.5em;
            }

            .transliteration {
                font-size: 1.5em;
            }

            .control-buttons {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Bengali Word Recorder</h1>
        </div>

        <div class="word-display">
            <div class="bengali-word" id="bengaliWord">‡¶Æ‡¶æ</div>
            <div class="transliteration" id="transliteration">maa</div>
            <div class="english-meaning" id="englishMeaning">(Mother)</div>
            <div class="progress" id="progress">1 of 20</div>
        </div>

        <div class="navigation">
            <button class="nav-btn" id="prevBtn" onclick="previousWord()">‚óÄ Previous</button>
            <button class="nav-btn" id="nextBtn" onclick="nextWord()">Next ‚ñ∂</button>
        </div>

        <div class="recording-controls">
            <div class="control-buttons">
                <button class="control-btn record-btn" id="recordBtn" onclick="toggleRecording()">üî¥ Record</button>
                <button class="control-btn play-btn" id="playBtn" onclick="playRecording()" disabled>‚ñ∂ Play</button>
            </div>
            <div class="status ready" id="status">Ready to record</div>
        </div>

        <div class="download-section">
            <button class="download-btn" id="downloadBtn" onclick="downloadAllRecordings()">üì¶ Download All Recordings</button>
            <div class="completion-stats" id="completionStats">0 of 20 words recorded</div>
        </div>

        <div id="errorMsg"></div>
    </div>

    <script>
        const bengaliWords = [
            { bengali: '‡¶Ö', english: 'a', pronunciation: 'aw', audioFile: 'aw.wav' },
            { bengali: '‡¶Ü', english: 'aa', pronunciation: 'ah', audioFile: 'ah.wav' },
            { bengali: '‡¶á', english: 'i', pronunciation: 'ee', audioFile: 'ee.wav' },
            { bengali: '‡¶à', english: 'ii', pronunciation: 'eee', audioFile: 'eee.wav' },
            { bengali: '‡¶â', english: 'u', pronunciation: 'oo', audioFile: 'oo.wav' },
            { bengali: '‡¶ä', english: 'uu', pronunciation: 'ooo', audioFile: 'ooo.wav' },
            { bengali: '‡¶è', english: 'e', pronunciation: 'eh', audioFile: 'eh.wav' },
            { bengali: '‡¶ê', english: 'oi', pronunciation: 'oy', audioFile: 'oy.wav' },
            { bengali: '‡¶ì', english: 'o', pronunciation: 'oh', audioFile: 'oh.wav' },
            { bengali: '‡¶î', english: 'ou', pronunciation: 'ow', audioFile: 'ow.wav' },
            { bengali: '‡¶ï', english: 'ka', pronunciation: 'kaw', audioFile: 'kaw.wav' },
            { bengali: '‡¶ñ', english: 'kha', pronunciation: 'khaw', audioFile: 'khaw.wav' },
            { bengali: '‡¶ó', english: 'ga', pronunciation: 'gaw', audioFile: 'gaw.wav' },
            { bengali: '‡¶ò', english: 'gha', pronunciation: 'ghaw', audioFile: 'ghaw.wav' },
            { bengali: '‡¶ö', english: 'cha', pronunciation: 'chaw', audioFile: 'chaw.wav' },
            { bengali: '‡¶õ', english: 'chha', pronunciation: 'chhaw', audioFile: 'chhaw.wav' },
            { bengali: '‡¶ú', english: 'ja', pronunciation: 'jaw', audioFile: 'jaw.wav' },
            { bengali: '‡¶ù', english: 'jha', pronunciation: 'jhaw', audioFile: 'jhaw.wav' },
            { bengali: '‡¶ü', english: 'ta', pronunciation: 'taw', audioFile: 'taw.wav' },
            { bengali: '‡¶†', english: 'tha', pronunciation: 'thaw', audioFile: 'thaw.wav' },
            { bengali: '‡¶°', english: 'da', pronunciation: 'daw', audioFile: 'daw.wav' },
            { bengali: '‡¶¢', english: 'dha', pronunciation: 'dhaw', audioFile: 'dhaw.wav' },
            { bengali: '‡¶£', english: 'na', pronunciation: 'naw', audioFile: 'naw.wav' },
            { bengali: '‡¶§', english: 'ta', pronunciation: 'taw', audioFile: 'taw2.wav' },
            { bengali: '‡¶•', english: 'tha', pronunciation: 'thaw', audioFile: 'thaw2.wav' },
            { bengali: '‡¶¶', english: 'da', pronunciation: 'daw', audioFile: 'daw2.wav' },
            { bengali: '‡¶ß', english: 'dha', pronunciation: 'dhaw', audioFile: 'dhaw2.wav' },
            { bengali: '‡¶®', english: 'na', pronunciation: 'naw', audioFile: 'naw2.wav' },
            { bengali: '‡¶™', english: 'pa', pronunciation: 'paw', audioFile: 'paw.wav' },
            { bengali: '‡¶´', english: 'pha', pronunciation: 'phaw', audioFile: 'phaw.wav' },
            { bengali: '‡¶¨', english: 'ba', pronunciation: 'baw', audioFile: 'baw.wav' },
            { bengali: '‡¶≠', english: 'bha', pronunciation: 'bhaw', audioFile: 'bhaw.wav' },
            { bengali: '‡¶Æ', english: 'ma', pronunciation: 'maw', audioFile: 'maw.wav' },
            { bengali: '‡¶Ø', english: 'ya', pronunciation: 'yaw', audioFile: 'yaw.wav' },
            { bengali: '‡¶∞', english: 'ra', pronunciation: 'raw', audioFile: 'raw.wav' },
            { bengali: '‡¶≤', english: 'la', pronunciation: 'law', audioFile: 'law.wav' },
            { bengali: '‡¶∂', english: 'sha', pronunciation: 'shaw', audioFile: 'shaw.wav' },
            { bengali: '‡¶∑', english: 'sha', pronunciation: 'shaw', audioFile: 'shaw2.wav' },
            { bengali: '‡¶∏', english: 'sa', pronunciation: 'saw', audioFile: 'saw.wav' },
            { bengali: '‡¶π', english: 'ha', pronunciation: 'haw', audioFile: 'haw.wav' }
        ];

        let currentWordIndex = 0;
        let mediaRecorder = null;
        let isRecording = false;
        let audioChunks = [];
        let recordings = new Map(); // Store recordings in memory
        let currentAudio = null;

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            updateWordDisplay();
            requestMicrophoneAccess();
        });

        async function requestMicrophoneAccess() {
            try {
                // Check if getUserMedia is supported
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    throw new Error('getUserMedia not supported');
                }

                const stream = await navigator.mediaDevices.getUserMedia({
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true,
                        sampleRate: 44100
                    }
                });
                stream.getTracks().forEach(track => track.stop()); // Stop the stream for now
                showStatus('Ready to record', 'ready');
            } catch (error) {
                console.error('Microphone access error:', error);
                let errorMessage = 'Microphone access failed. ';

                if (error.name === 'NotAllowedError') {
                    errorMessage += 'Please allow microphone access and reload the page.';
                } else if (error.name === 'NotFoundError') {
                    errorMessage += 'No microphone found. Please connect a microphone.';
                } else if (error.name === 'NotSupportedError') {
                    errorMessage += 'Your browser does not support audio recording.';
                } else if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
                    errorMessage += 'Audio recording requires HTTPS or localhost.';
                } else {
                    errorMessage += `Error: ${error.message}`;
                }

                showError(errorMessage);
            }
        }

        function updateWordDisplay() {
            const word = bengaliWords[currentWordIndex];
            document.getElementById('bengaliWord').textContent = word.bengali;
            document.getElementById('transliteration').textContent = word.transliteration;
            document.getElementById('englishMeaning').textContent = `(${word.english})`;
            document.getElementById('progress').textContent = `${currentWordIndex + 1} of ${bengaliWords.length}`;

            // Update navigation buttons
            document.getElementById('prevBtn').disabled = currentWordIndex === 0;
            document.getElementById('nextBtn').disabled = currentWordIndex === bengaliWords.length - 1;

            // Update play button
            updatePlayButtonState();
            updateCompletionStats();
        }

        function updatePlayButtonState() {
            const word = bengaliWords[currentWordIndex];
            const hasRecording = recordings.has(word.transliteration);
            document.getElementById('playBtn').disabled = !hasRecording;
        }

        function updateCompletionStats() {
            const recordedCount = recordings.size;
            document.getElementById('completionStats').textContent =
                `${recordedCount} of ${bengaliWords.length} words recorded`;

            document.getElementById('downloadBtn').disabled = recordedCount === 0;
        }

        function previousWord() {
            if (currentWordIndex > 0) {
                currentWordIndex--;
                updateWordDisplay();
            }
        }

        function nextWord() {
            if (currentWordIndex < bengaliWords.length - 1) {
                currentWordIndex++;
                updateWordDisplay();
            }
        }

        async function toggleRecording() {
            if (isRecording) {
                stopRecording();
            } else {
                await startRecording();
            }
        }

        async function startRecording() {
            try {
                // Check browser support
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    throw new Error('Your browser does not support audio recording');
                }

                const stream = await navigator.mediaDevices.getUserMedia({
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true,
                        sampleRate: 44100
                    }
                });

                // Check MediaRecorder support
                if (!MediaRecorder.isTypeSupported('audio/webm') &&
                    !MediaRecorder.isTypeSupported('audio/mp4') &&
                    !MediaRecorder.isTypeSupported('audio/wav')) {
                    throw new Error('Your browser does not support audio recording');
                }

                // Choose the best supported format
                let mimeType = 'audio/webm';
                if (MediaRecorder.isTypeSupported('audio/webm;codecs=opus')) {
                    mimeType = 'audio/webm;codecs=opus';
                } else if (MediaRecorder.isTypeSupported('audio/mp4')) {
                    mimeType = 'audio/mp4';
                } else if (MediaRecorder.isTypeSupported('audio/wav')) {
                    mimeType = 'audio/wav';
                }

                mediaRecorder = new MediaRecorder(stream, { mimeType });
                audioChunks = [];

                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        audioChunks.push(event.data);
                    }
                };

                mediaRecorder.onstop = () => {
                    const audioBlob = new Blob(audioChunks, { type: mimeType });
                    const word = bengaliWords[currentWordIndex];
                    recordings.set(word.transliteration, audioBlob);

                    stream.getTracks().forEach(track => track.stop());
                    showStatus('Recording saved!', 'saved');
                    updatePlayButtonState();
                    updateCompletionStats();
                };

                mediaRecorder.onerror = (event) => {
                    console.error('MediaRecorder error:', event.error);
                    showError('Recording failed: ' + event.error.message);
                    stream.getTracks().forEach(track => track.stop());
                    resetRecordingState();
                };

                mediaRecorder.start();
                isRecording = true;

                document.getElementById('recordBtn').textContent = '‚èπ Stop Recording';
                document.getElementById('recordBtn').classList.add('recording');
                showStatus('Recording...', 'recording');

            } catch (error) {
                console.error('Start recording error:', error);
                let errorMessage = 'Failed to start recording. ';

                if (error.name === 'NotAllowedError') {
                    errorMessage += 'Please allow microphone access.';
                } else if (error.name === 'NotFoundError') {
                    errorMessage += 'No microphone found.';
                } else if (error.name === 'NotSupportedError') {
                    errorMessage += 'Your browser does not support audio recording.';
                } else if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
                    errorMessage += 'Audio recording requires HTTPS or localhost.';
                } else {
                    errorMessage += error.message;
                }

                showError(errorMessage);
                resetRecordingState();
            }
        }

        function resetRecordingState() {
            isRecording = false;
            document.getElementById('recordBtn').textContent = 'üî¥ Record';
            document.getElementById('recordBtn').classList.remove('recording');
        }

        function stopRecording() {
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();
                resetRecordingState();
            }
        }

        function playRecording() {
            const word = bengaliWords[currentWordIndex];
            const audioBlob = recordings.get(word.transliteration);

            if (audioBlob) {
                // Stop current audio if playing
                if (currentAudio) {
                    currentAudio.pause();
                    currentAudio = null;
                }

                const audioUrl = URL.createObjectURL(audioBlob);
                currentAudio = new Audio(audioUrl);

                currentAudio.onplay = () => {
                    showStatus('Playing...', 'playing');
                };

                currentAudio.onended = () => {
                    showStatus('Ready to record', 'ready');
                    URL.revokeObjectURL(audioUrl);
                };

                currentAudio.onerror = () => {
                    showError('Failed to play recording');
                    URL.revokeObjectURL(audioUrl);
                };

                currentAudio.play();
            }
        }

        async function downloadAllRecordings() {
            if (recordings.size === 0) {
                showError('No recordings to download');
                return;
            }

            try {
                showStatus('Preparing download...', 'ready');

                const zip = new JSZip();
                const audioFolder = zip.folder('audio').folder('words');

                // Convert recordings to MP3-like format (actually WAV with MP3 extension for simplicity)
                for (const [transliteration, audioBlob] of recordings) {
                    audioFolder.file(`${transliteration}.wav`, audioBlob);
                }

                // Generate and download the ZIP file
                const content = await zip.generateAsync({ type: 'blob' });
                const url = URL.createObjectURL(content);

                const a = document.createElement('a');
                a.href = url;
                a.download = 'bengali-word-recordings.zip';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                showStatus('Download complete!', 'saved');

            } catch (error) {
                showError('Failed to create download. Please try again.');
            }
        }

        function showStatus(message, type) {
            const statusElement = document.getElementById('status');
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
            clearError();
        }

        function showError(message) {
            const errorElement = document.getElementById('errorMsg');
            errorElement.innerHTML = `<div class="error">${message}</div>`;
        }

        function clearError() {
            document.getElementById('errorMsg').innerHTML = '';
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA') return;

            switch(event.key) {
                case 'ArrowLeft':
                    previousWord();
                    break;
                case 'ArrowRight':
                    nextWord();
                    break;
                case ' ':
                    event.preventDefault();
                    toggleRecording();
                    break;
                case 'Enter':
                    if (recordings.has(bengaliWords[currentWordIndex].transliteration)) {
                        playRecording();
                    }
                    break;
            }
        });
    </script>
</body>
</html>